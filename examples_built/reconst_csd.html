<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Dipy &mdash; dipy 0.10.0dev documentation</title>
    
    <link rel="stylesheet" href="../_static/dipy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.10.0dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="dipy 0.10.0dev documentation" href="../index.html" />
  <meta name="keywords" content="dipy, dMRI, DTI, DSI, diffusion MRI, Tensor,
  neuroimaging, python, neuroscience, Eleftherios, Garyfallidis, tractography,
  streamlines, fiber tracking">

  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
 <a href="../index.html">
  <img src="../_static/dipy-banner.png" alt="dipy logo"  border="0" />
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="../index.html">Home</a> |&nbsp;</li>
  <li><a href="../stateoftheart.html">Overview</a> |&nbsp;</li>
  <li><a href="../examples_index.html">Gallery</a> |&nbsp;</li>
  <li><a href="../installation.html">Download</a> |&nbsp;</li>
  <li><a href="../subscribe.html">Subscribe</a> |&nbsp;</li>
  <li><a href="../developers.html">Developers</a> |&nbsp;</li>
  <li><a href="../cite.html">Cite</a> &nbsp;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

  
<h4> Site Navigation </h4>
  <ul>
    <li><a href="../documentation.html">Documentation</a></li>
    <li><a href="../devel/index.html">Development</a></li>
  </ul>

<h4> NIPY Community </h4>
  <ul class="simple">
    <li><a class="reference external"
	href="http://nipy.org/">Community Home</a></li>
    <li><a class="reference external"
	href="http://nipy.org/software/projects/">NIPY Projects</a></li>
    <li><a class="reference external"
	href="http://mail.scipy.org/mailman/listinfo/nipy-devel">Mailing List</a></li>
    <li><a class="reference external"
	href="http://nipy.org/software/license/index.html">License</a></li>
  </ul>


  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/examples_built/reconst_csd.txt"
           rel="nofollow">Show Source</a></li>
  </ul>

<div id="searchbox-ml" style="display: none">
  <h3>Search mailing list archive</h3>
  <script type="text/javascript">
    function mlsearch(curobj)
    {
    curobj.q.value="site:mail.scipy.org/pipermail/nipy-devel/ "+curobj.userquery.value
    }
  </script>
  <form action="http://www.google.com/search" method="get" onSubmit="mlsearch(this)">
    <input name="userquery" size="13" type="text" /> <input type="submit" value="Go" />
    <input name="q" type="hidden" />
  </form>
</div>
  
<div id="searchbox-site" style="display: none">
  <h3>Search this site</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="13" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    </p>
</div>
<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="reconstruction-with-constrained-spherical-deconvolution">
<span id="reconst-csd"></span><span id="example-reconst-csd"></span><h1>Reconstruction with Constrained Spherical Deconvolution<a class="headerlink" href="#reconstruction-with-constrained-spherical-deconvolution" title="Permalink to this headline">Â¶</a></h1>
<p>This example shows how to use Constrained Spherical Deconvolution (CSD)
introduced by Tournier et al. <a class="reference internal" href="#tournier2007" id="id1">[Tournier2007]</a>.</p>
<p>This method is mainly useful with datasets with gradient directions acquired on
a spherical grid.</p>
<p>The basic idea with this method is that if we could estimate the response
function of a single fiber then we could deconvolve the measured signal and
obtain the underlying fiber distribution.</p>
<p>Let&#8217;s first load the data. We will use a dataset with 10 b0s and 150 non-b0s
with b-value 2000.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="n">fetch_stanford_hardi</span><span class="p">,</span> <span class="n">read_stanford_hardi</span>

<span class="n">fetch_stanford_hardi</span><span class="p">()</span>
<span class="n">img</span><span class="p">,</span> <span class="n">gtab</span> <span class="o">=</span> <span class="n">read_stanford_hardi</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</pre></div>
</div>
<p>You can verify the b-values of the datasets by looking at the attribute
<cite>gtab.bvals</cite>.</p>
<p>In CSD there is an important pre-processing step: the estimation of the fiber
response function. In order to do this we look for regions of the brain where
it is known that there are single coherent fiber populations. For example if we
use an ROI at the center of the brain, we will find single fibers from the
corpus callosum. The <tt class="docutils literal"><span class="pre">auto_response</span></tt> function will calculate FA for an ROI of
radius equal to <tt class="docutils literal"><span class="pre">roi_radius</span></tt> in the center of the volume and return the
response function estimated in that region for the voxels with FA higher than
0.7.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">dipy.reconst.csdeconv</span> <span class="kn">import</span> <span class="n">auto_response</span>

<span class="n">response</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">=</span> <span class="n">auto_response</span><span class="p">(</span><span class="n">gtab</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">roi_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fa_thr</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">response</span></tt> tuple contains two elements. The first is an array with
the eigenvalues of the response function and the second is the average S0 for
this response.</p>
<p>It is good practice to always validate the result of auto_response. For
this purpose we can print the elements of <tt class="docutils literal"><span class="pre">response</span></tt> and have a look at their
values.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
<p>(array([ 0.0014,  0.00029,  0.00029]), 416.206)</p>
<p>The tensor generated from the response must be prolate (two smaller eigenvalues
should be equal) and look anisotropic with a ratio of second to first eigenvalue
of about 0.2. Or in other words, the axial diffusivity of this tensor should
be around 5 times larger than the radial diffusivity.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
</pre></div>
</div>
<p>0.21197</p>
<p>We can double-check that we have a good response function by visualizing the
response function&#8217;s ODF. Here is how you would do that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="kn">import</span> <span class="n">fvtk</span>
<span class="n">ren</span> <span class="o">=</span> <span class="n">fvtk</span><span class="o">.</span><span class="n">ren</span><span class="p">()</span>
<span class="n">evals</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">evecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="n">get_sphere</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">get_sphere</span><span class="p">(</span><span class="s">&#39;symmetric724&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">dipy.sims.voxel</span> <span class="kn">import</span> <span class="n">single_tensor_odf</span>
<span class="n">response_odf</span> <span class="o">=</span> <span class="n">single_tensor_odf</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">evals</span><span class="p">,</span> <span class="n">evecs</span><span class="p">)</span>
<span class="n">response_actor</span> <span class="o">=</span> <span class="n">fvtk</span><span class="o">.</span><span class="n">sphere_funcs</span><span class="p">(</span><span class="n">response_odf</span><span class="p">,</span> <span class="n">sphere</span><span class="p">)</span>
<span class="n">fvtk</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">response_actor</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Saving illustration as csd_response.png&#39;</span><span class="p">)</span>
<span class="n">fvtk</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s">&#39;csd_response.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/csd_response.png" src="../_images/csd_response.png" />
<p class="caption"><strong>Estimated response function</strong>.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fvtk</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">response_actor</span><span class="p">)</span>
</pre></div>
</div>
<p>Depending on the dataset, FA threshold may not be the best way to find the
best possible response function. For one, it depends on the diffusion tensor
(FA and first eigenvector), which has lower accuracy at high
b-values. Alternatively, the response function can be calibrated in a
data-driven manner <a class="reference internal" href="#tax2014" id="id2">[Tax2014]</a>.</p>
<p>First, the data is deconvolved with a &#8216;fat&#8217; response function. All voxels that
are considered to contain only one peak in this deconvolution (as determined by
the peak threshold which gives an upper limit of the ratio of the second peak
to the first peak) are maintained, and from these voxels a new response
function is determined. This process is repeated until convergence is
reached. Here we calibrate the response function on a small part of the data.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">dipy.reconst.csdeconv</span> <span class="kn">import</span> <span class="n">recursive_response</span>
</pre></div>
</div>
<p>A WM mask can shorten computation time for the whole dataset. Here it is created
based on the DTI fit.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">dipy.reconst.dti</span> <span class="kn">as</span> <span class="nn">dti</span>
<span class="n">tenmodel</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">TensorModel</span><span class="p">(</span><span class="n">gtab</span><span class="p">)</span>
<span class="n">tenfit</span> <span class="o">=</span> <span class="n">tenmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">dipy.reconst.dti</span> <span class="kn">import</span> <span class="n">fractional_anisotropy</span>
<span class="n">FA</span> <span class="o">=</span> <span class="n">fractional_anisotropy</span><span class="p">(</span><span class="n">tenfit</span><span class="o">.</span><span class="n">evals</span><span class="p">)</span>
<span class="n">MD</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">mean_diffusivity</span><span class="p">(</span><span class="n">tenfit</span><span class="o">.</span><span class="n">evals</span><span class="p">)</span>
<span class="n">wm_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">FA</span> <span class="o">&gt;=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">FA</span> <span class="o">&gt;=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">MD</span> <span class="o">&gt;=</span> <span class="mf">0.0011</span><span class="p">))))</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">recursive_response</span><span class="p">(</span><span class="n">gtab</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">wm_mask</span><span class="p">,</span> <span class="n">sh_order</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                              <span class="n">peak_thr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">init_fa</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span>
                              <span class="n">init_trace</span><span class="o">=</span><span class="mf">0.0021</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                              <span class="n">parallel</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>We can check the shape of the signal of the response function, which should be
like  a pancake:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">response_signal</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">on_sphere</span><span class="p">(</span><span class="n">sphere</span><span class="p">)</span>
<span class="n">response_actor</span> <span class="o">=</span> <span class="n">fvtk</span><span class="o">.</span><span class="n">sphere_funcs</span><span class="p">(</span><span class="n">response_signal</span><span class="p">,</span> <span class="n">sphere</span><span class="p">)</span>

<span class="n">ren</span> <span class="o">=</span> <span class="n">fvtk</span><span class="o">.</span><span class="n">ren</span><span class="p">()</span>

<span class="n">fvtk</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">response_actor</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Saving illustration as csd_recursive_response.png&#39;</span><span class="p">)</span>
<span class="n">fvtk</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s">&#39;csd_recursive_response.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/csd_recursive_response.png" src="../_images/csd_recursive_response.png" />
<p class="caption"><strong>Estimated response function using recursive calibration</strong>.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fvtk</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">response_actor</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, that we have the response function, we are ready to start the deconvolution
process. Let&#8217;s import the CSD model and fit the datasets.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">dipy.reconst.csdeconv</span> <span class="kn">import</span> <span class="n">ConstrainedSphericalDeconvModel</span>
<span class="n">csd_model</span> <span class="o">=</span> <span class="n">ConstrainedSphericalDeconvModel</span><span class="p">(</span><span class="n">gtab</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
<p>For illustration purposes we will fit only a small portion of the data.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data_small</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="mi">55</span><span class="p">:</span><span class="mi">85</span><span class="p">,</span> <span class="mi">38</span><span class="p">:</span><span class="mi">39</span><span class="p">]</span>
<span class="n">csd_fit</span> <span class="o">=</span> <span class="n">csd_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_small</span><span class="p">)</span>
</pre></div>
</div>
<p>Show the CSD-based ODFs also known as FODFs (fiber ODFs).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">csd_odf</span> <span class="o">=</span> <span class="n">csd_fit</span><span class="o">.</span><span class="n">odf</span><span class="p">(</span><span class="n">sphere</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we visualize only a 30x30 region.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fodf_spheres</span> <span class="o">=</span> <span class="n">fvtk</span><span class="o">.</span><span class="n">sphere_funcs</span><span class="p">(</span><span class="n">csd_odf</span><span class="p">,</span> <span class="n">sphere</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">fvtk</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">fodf_spheres</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Saving illustration as csd_odfs.png&#39;</span><span class="p">)</span>
<span class="n">fvtk</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s">&#39;csd_odfs.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/csd_odfs.png" src="../_images/csd_odfs.png" />
<p class="caption"><strong>CSD ODFs</strong>.</p>
</div>
<p>In Dipy we also provide tools for finding the peak directions (maxima) of the
ODFs. For this purpose we recommend using <tt class="docutils literal"><span class="pre">peaks_from_model</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">dipy.direction</span> <span class="kn">import</span> <span class="n">peaks_from_model</span>

<span class="n">csd_peaks</span> <span class="o">=</span> <span class="n">peaks_from_model</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">csd_model</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="n">data_small</span><span class="p">,</span>
                             <span class="n">sphere</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span>
                             <span class="n">relative_peak_threshold</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span>
                             <span class="n">min_separation_angle</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                             <span class="n">parallel</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">fvtk</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">ren</span><span class="p">)</span>
<span class="n">fodf_peaks</span> <span class="o">=</span> <span class="n">fvtk</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="n">csd_peaks</span><span class="o">.</span><span class="n">peak_dirs</span><span class="p">,</span> <span class="n">csd_peaks</span><span class="o">.</span><span class="n">peak_values</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
<span class="n">fvtk</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">fodf_peaks</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Saving illustration as csd_peaks.png&#39;</span><span class="p">)</span>
<span class="n">fvtk</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s">&#39;csd_peaks.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/csd_peaks.png" src="../_images/csd_peaks.png" />
<p class="caption"><strong>CSD Peaks</strong>.</p>
</div>
<p>We can finally visualize both the ODFs and peaks in the same space.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fodf_spheres</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">fvtk</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">fodf_spheres</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Saving illustration as csd_both.png&#39;</span><span class="p">)</span>
<span class="n">fvtk</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s">&#39;csd_both.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/csd_both.png" src="../_images/csd_both.png" />
<p class="caption"><strong>CSD Peaks and ODFs</strong>.</p>
</div>
<table class="docutils citation" frame="void" id="tournier2007" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[Tournier2007]</a></td><td>J-D. Tournier, F. Calamante and A. Connelly, &#8220;Robust determination of the fibre orientation distribution in diffusion MRI: Non-negativity constrained super-resolved spherical deconvolution&#8221;, Neuroimage, vol. 35, no. 4, pp. 1459-1472, 2007.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="tax2014" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[Tax2014]</a></td><td>C.M.W. Tax, B. Jeurissen, S.B. Vos, M.A. Viergever, A. Leemans, &#8220;Recursive calibration of the fiber response function for spherical deconvolution of diffusion MRI data&#8221;, Neuroimage, vol. 86, pp. 67-80, 2014.</td></tr>
</tbody>
</table>
<div class="admonition-example-source-code admonition">
<p class="first admonition-title">Example source code</p>
<p class="last">You can download <a class="reference download internal" href="../_downloads/reconst_csd.py"><tt class="xref download docutils literal"><span class="pre">the</span> <span class="pre">full</span> <span class="pre">source</span> <span class="pre">code</span> <span class="pre">of</span> <span class="pre">this</span> <span class="pre">example</span></tt></a>.
This same script is also included in the dipy source distribution under the
<tt class="file docutils literal"><span class="pre">doc/examples/</span></tt> directory.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="../index.html">Home</a> |&nbsp;</li>
  <li><a href="../stateoftheart.html">Overview</a> |&nbsp;</li>
  <li><a href="../examples_index.html">Gallery</a> |&nbsp;</li>
  <li><a href="../installation.html">Download</a> |&nbsp;</li>
  <li><a href="../subscribe.html">Subscribe</a> |&nbsp;</li>
  <li><a href="../developers.html">Developers</a> |&nbsp;</li>
  <li><a href="../cite.html">Cite</a> &nbsp;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2015, dipy developers &lt;nipy-devel@neuroimaging.scipy.org&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>